<div class="menu-page">

    <h2 class="menu-title">üçΩ Qu·∫£n l√Ω th·ª±c ƒë∆°n</h2>

    <div class="menu-toolbar left-align">
        <input id="searchMenu" type="text" class="menu-input" placeholder="T√¨m m√≥n theo t√™n...">

        <select id="filterCategory" class="menu-select">
            <option value="all">T·∫•t c·∫£</option>
            <option value="cafe">C√† ph√™</option>
            <option value="tra">Tr√† tr√°i c√¢y</option>
            <option value="trasua">Tr√† s·ªØa</option>
            <option value="nuocep">N∆∞·ªõc √©p</option>
            <option value="banh">B√°nh ng·ªçt</option>
            <option value="monno">M√≥n no</option>
            <option value="snack">ƒÇn v·∫∑t</option>
        </select>

        <button id="btnAdd" class="btn-primary" onclick="openMenuModal('add')">
            + Th√™m m√≥n m·ªõi
        </button>
    </div>


    <!-- ===================== MODAL ===================== -->
    <div id="menuModal" class="menu-modal">
        <div class="menu-modal-box">
            <h3 id="modalTitle">Th√™m m√≥n m·ªõi</h3>

            <label>T√™n m√≥n</label>
            <input id="mName" type="text">

            <label>Gi√°</label>
            <input id="mPrice" type="number">

            <label>Danh m·ª•c</label>
            <select id="mCategory">
                <option value="cafe">C√† ph√™</option>
                <option value="tra">Tr√†</option>
                <option value="trasua">Tr√† s·ªØa</option>
                <option value="monno">M√≥n no</option>
                <option value="banh">B√°nh</option>
                <option value="snack">ƒÇn v·∫∑t</option>
                <option value="nuocep">N∆∞·ªõc √©p</option>
            </select>

            <label>H√¨nh ·∫£nh (URL)</label>
            <input id="mImg" type="text">

            <label>M√¥ t·∫£</label>
            <textarea id="mDesc" rows="3"></textarea>

            <label>Tr·∫°ng th√°i</label>
            <select id="mStatus">
                <option value="ok">C√≤n h√†ng</option>
                <option value="no">H·∫øt h√†ng</option>
            </select>

            <div class="menu-actions">
                <button id="btnSave" class="btn-save">L∆∞u</button>
                <button id="btnClose" class="btn-cancel">H·ªßy</button>
            </div>
        </div>
    </div>


    <!-- ===================== TABLE ===================== -->
    <table class="menu-table" style="width: 100%; margin-top: 15px; border-collapse: collapse;">
        <thead>
            <tr>
                <th>·∫¢nh</th>
                <th>T√™n m√≥n</th>
                <th>Gi√°</th>
                <th>Danh m·ª•c</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="menuBody"></tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const APP_KEY = "qr_order_demo_v1";

    function getMenu(){
        const data = JSON.parse(localStorage.getItem(APP_KEY));
        return data?.menu || [];
    }

    function formatVND(n){
        return Number(n).toLocaleString("vi-VN") + " ‚Ç´";
    }

    const tbody = document.getElementById("menuBody");
    const search = document.getElementById("searchMenu");
    const filter = document.getElementById("filterCategory");

    function renderTable(items){
        tbody.innerHTML = items.map(m => `
            <tr>
                <td><img src="${m.img}" style="width:60px;height:60px;border-radius:6px;object-fit:cover"></td>
                <td>${m.name}</td>
                <td>${formatVND(m.price)}</td>
                <td>${m.category}</td>
                <td>${m.status === "ok" ? "<span style='color:green'>C√≤n h√†ng</span>" : "<span style='color:red'>H·∫øt h√†ng</span>"}</td>
                <td>
                    <button onclick="openMenuModal('edit', ${m.id})" class="btn-edit">S·ª≠a</button>
                    <button onclick="deleteMenu(${m.id})" class="btn-delete">X√≥a</button>
                </td>
            </tr>
        `).join("");
    }

    function applyFilter(){
        let items = getMenu();

        const q = search.value.trim().toLowerCase();
        if (q) items = items.filter(m => m.name.toLowerCase().includes(q));

        const cat = filter.value;
        if (cat !== "all") {
            items = items.filter(m => m.category === cat);
        }

        renderTable(items);
    }

    search.oninput = applyFilter;
    filter.onchange = applyFilter;

    applyFilter();
});


/* ================= XO√Å M√ìN ================= */
function deleteMenu(id){
    if (!confirm("X√≥a m√≥n n√†y?")) return;

    const APP_KEY = "qr_order_demo_v1";
    const data = JSON.parse(localStorage.getItem(APP_KEY));

    data.menu = data.menu.filter(m => m.id != id);

    localStorage.setItem(APP_KEY, JSON.stringify(data));
    location.reload();
}


/* ========== ƒê√ìNG MODAL ========== */
document.addEventListener("click", (e) => {
    if (e.target.id === "btnClose" || e.target.id === "menuModal") {
        document.getElementById("menuModal").classList.remove("show");
    }
});
</script>
